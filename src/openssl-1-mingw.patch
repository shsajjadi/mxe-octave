This file is part of mingw-cross-env.
See doc/index.html for further information.

This patch has been taken from:
http://www.mail-archive.com/openssl-dev@openssl.org/msg27484.html

diff -ru openssl-1.0.0-orig/apps/speed.c openssl-1.0.0/apps/speed.c
--- openssl-1.0.0-orig/apps/speed.c	2010-03-03 14:56:18.000000000 -0500
+++ openssl-1.0.0/apps/speed.c	2010-03-30 02:06:56.763000000 -0400
@@ -295,7 +295,7 @@
 		if (thr==NULL)
 			{
 			DWORD ret=GetLastError();
-			BIO_printf(bio_err,"unable to CreateThread (%d)",ret);
+			BIO_printf(bio_err,"unable to CreateThread (%u)",ret);
 			ExitProcess(ret);
 			}
 		CloseHandle(thr);		/* detach the thread	*/
diff -ru openssl-1.0.0-orig/Configure openssl-1.0.0/Configure
--- openssl-1.0.0-orig/Configure	2010-01-19 16:40:54.000000000 -0500
+++ openssl-1.0.0/Configure	2010-03-30 02:06:49.782000000 -0400
@@ -1035,6 +1035,8 @@
 
 my $IsMK1MF=scalar grep /^$target$/,@MK1MF_Builds;
 
+$IsMK1MF=1 if ($target eq "mingw" && $^O ne "cygwin" && !is_msys());
+
 $exe_ext=".exe" if ($target eq "Cygwin" || $target eq "DJGPP" || $target =~ /^mingw/);
 $exe_ext=".nlm" if ($target =~ /netware/);
 $exe_ext=".pm"  if ($target =~ /vos/);
@@ -2040,3 +2042,11 @@
 	print STDERR "No sanity errors detected!\n" if $errorcnt == 0;
 	return $errorcnt;
 	}
+
+# Attempt to detect MSYS environment
+
+sub is_msys
+	{
+	return 1 if (exists $ENV{"TERM"} && $ENV{"TERM"} eq "msys");
+	return 0;
+	}
diff -ru openssl-1.0.0-orig/util/pl/Mingw32.pl openssl-1.0.0/util/pl/Mingw32.pl
--- openssl-1.0.0-orig/util/pl/Mingw32.pl	2008-04-17 06:19:16.000000000 -0400
+++ openssl-1.0.0/util/pl/Mingw32.pl	2010-03-30 02:06:53.097000000 -0400
@@ -19,7 +19,7 @@
 if ($debug)
 	{ $cflags="-DL_ENDIAN -DDSO_WIN32 -g2 -ggdb"; }
 else
-	{ $cflags="-DL_ENDIAN -DDSO_WIN32 -fomit-frame-pointer -O3 -mcpu=i486 -Wall"; }
+	{ $cflags="-DL_ENDIAN -DDSO_WIN32 -fomit-frame-pointer -O3 -march=i486 -Wall"; }
 
 if ($gaswin and !$no_asm)
 	{
@@ -66,6 +66,7 @@
 $shlibp=".a";
 $lfile='';
 
+$asmtype='coff';
 $asm='as';
 $afile='-o ';
 #$bn_asm_obj="";
